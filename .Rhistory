import os
import os
# Nombre del archivo de salida
output_file <- "diagnostico.txt"
# Carpetas que vamos a ignorar en el árbol para no ensuciar
ignore_patterns <- c("^\\.git", "^_site", "^_freeze", "^renv/library", "^\\.quarto", "^docs")
# Archivos de los que queremos ver el CÓDIGO INTERNO
target_configs <- c("_quarto.yml", "_quarto.yaml", "renv.lock", "DESCRIPTION", ".Rprofile")
# Función para verificar si un archivo debe ser ignorado
should_ignore <- function(path) {
any(sapply(ignore_patterns, function(p) grepl(p, path)))
}
# Iniciar escritura del archivo
sink(output_file)
cat("=== ESTRUCTURA DEL PROYECTO (R/QUARTO) ===\n")
# Listar todos los archivos recursivamente
all_files <- list.files(recursive = TRUE, full.names = TRUE, include.dirs = TRUE)
# Filtrar lista
clean_files <- all_files[!sapply(all_files, should_ignore)]
# Imprimir árbol simple
for (f in clean_files) {
cat(sub("^./", "", f), "\n")
}
cat("\n\n=== CONTENIDO DE CONFIGURACIÓN Y WORKFLOWS ===\n")
for (f in clean_files) {
# Limpiar ruta relativa
clean_path <- sub("^./", "", f)
filename <- basename(f)
# Lógica para decidir qué archivos leer
# 1. Archivos .yml/.yaml dentro de .github/workflows
is_workflow <- grepl("^\\.github/workflows/.*\\.ya?ml$", clean_path)
# 2. Archivos de configuración de Quarto/R
is_config <- filename %in% target_configs
if (is_workflow || is_config) {
cat(paste0("\n--- INICIO: ", clean_path, " ---\n"))
tryCatch({
lines <- readLines(f, warn = FALSE)
cat(paste(lines, collapse = "\n"))
}, error = function(e) {
cat(paste("[Error leyendo archivo:", e$message, "]"))
})
cat(paste0("\n--- FIN: ", clean_path, " ---\n"))
}
}
sink() # Cerrar archivo
message(paste("¡Listo! Archivo generado:", file.path(getwd(), output_file)))
message("Por favor, abre el archivo, copia el contenido y pégalo en el chat.")
/.quarto/
